<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>9MM ‚Äî Challenge Militaire Avance</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root{--red:#FF1717;--cyan:#00EDEF;--black:#0a0a0a}
body{font-family:'Inter',sans-serif;background:var(--black);color:#fff;margin:0;min-height:100vh;overflow-x:hidden}
.font-oswald{font-family:'Oswald',sans-serif}
@keyframes border-beam{0%{transform:translateY(-100%)}100%{transform:translateY(100vh)}}
@keyframes fadeSlideBlurIn{0%{opacity:0;transform:translateY(20px);filter:blur(8px)}100%{opacity:1;transform:translateY(0);filter:blur(0)}}
@keyframes pulseDot{0%,100%{opacity:.3}50%{opacity:1}}
@keyframes progressFill{0%{width:0}100%{width:100%}}
.fade-in{animation:fadeSlideBlurIn .6s cubic-bezier(.16,1,.3,1) both}
*,*::before,*::after{box-sizing:border-box}

/* Shared UI */
.glass-card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:16px;backdrop-filter:blur(10px);overflow:hidden;position:relative}
.btn-red{background:linear-gradient(135deg,var(--red),#cc1212);color:#fff;font-weight:700;padding:16px;border-radius:12px;border:none;cursor:pointer;font-size:1.05rem;transition:all .3s;width:100%;font-family:'Oswald',sans-serif;text-transform:uppercase;letter-spacing:.04em}
.btn-red:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 30px rgba(255,23,23,.3)}
.btn-red:disabled{opacity:.35;cursor:not-allowed;transform:none!important}
.form-group{display:flex;flex-direction:column;gap:6px}
.form-group label{font-size:11px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:rgba(255,255,255,.4)}
.form-group input{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:#fff;padding:14px 16px;border-radius:12px;width:100%;font-size:16px;outline:none;transition:all .3s;backdrop-filter:blur(6px)}
.form-group input::placeholder{color:rgba(255,255,255,.25)}
.form-group input:focus,.form-group select:focus{border-color:var(--red);background:rgba(255,255,255,.09);box-shadow:0 0 0 3px rgba(255,23,23,.1)}
.form-group select{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:rgba(255,255,255,.5);padding:14px 16px;border-radius:12px;width:100%;font-size:16px;outline:none;transition:all .3s;backdrop-filter:blur(6px);-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='rgba(255,255,255,.4)' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 16px center;padding-right:40px}
.form-group select option{background:#1a1a1a;color:#fff}
input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}
input[type=number]{-moz-appearance:textfield}

/* Option buttons */
.opt-btn{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:14px 18px;cursor:pointer;text-align:left;transition:all .25s;display:flex;align-items:center;gap:12px;width:100%;color:#fff;font-size:14px}
.opt-btn:hover{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.15);transform:translateX(4px)}
.opt-btn.selected{background:rgba(255,23,23,.08);border-color:rgba(255,23,23,.25);box-shadow:0 0 20px rgba(255,23,23,.08)}
.opt-btn.multi.selected{background:rgba(255,23,23,.08);border-color:rgba(255,23,23,.25)}
.opt-icon{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;background:rgba(255,255,255,.06);flex-shrink:0}
.opt-btn.selected .opt-icon{background:rgba(255,23,23,.15)}

/* Slider */
.slider-track{width:100%;height:8px;border-radius:99px;background:rgba(255,255,255,.06);position:relative;cursor:pointer}
.slider-fill{height:100%;border-radius:99px;background:var(--red);transition:width .15s}
.slider-thumb{width:24px;height:24px;border-radius:50%;background:#fff;border:3px solid var(--red);position:absolute;top:50%;transform:translate(-50%,-50%);cursor:grab;box-shadow:0 2px 8px rgba(0,0,0,.3);transition:left .15s}
.slider-labels{display:flex;justify-content:space-between;margin-top:8px;font-size:12px;color:rgba(255,255,255,.3)}

/* Score dots */
.score-dots{display:flex;gap:4px;align-items:center}
.score-dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.1);transition:background .3s}
.score-dot.filled{background:var(--red)}

/* Loading screen */
.loading-step{display:flex;align-items:center;gap:12px;padding:12px 0;opacity:.3;transition:opacity .5s}
.loading-step.active{opacity:1}
.loading-step.done{opacity:.5}
.loading-dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.15);transition:background .3s}
.loading-step.active .loading-dot{background:var(--red);animation:pulseDot 1s ease infinite}
.loading-step.done .loading-dot{background:var(--red)}
.loading-bar{width:100%;height:4px;border-radius:99px;background:rgba(255,255,255,.06);overflow:hidden;margin-bottom:24px}
.loading-bar-fill{height:100%;border-radius:99px;background:var(--red);transition:width .8s cubic-bezier(.16,1,.3,1)}

/* Comparison table */
.compare-table{width:100%;border-collapse:separate;border-spacing:0}
.compare-table td{padding:10px 14px;border-bottom:1px solid rgba(255,255,255,.04);font-size:13px}
.compare-table td:first-child{color:rgba(255,255,255,.3);width:30%}
.compare-col-gym{color:rgba(255,255,255,.4)}
.compare-col-mil{color:var(--red);font-weight:600}

/* Progress bar */
.quiz-progress{position:fixed;top:0;left:0;right:0;height:3px;z-index:100;background:rgba(255,255,255,.03)}
.quiz-progress-fill{height:100%;background:var(--red);transition:width .5s cubic-bezier(.16,1,.3,1)}

/* Stat bar */
.stat-bar{height:6px;border-radius:99px;background:rgba(255,255,255,.06);overflow:hidden}
.stat-fill{height:100%;border-radius:99px;background:var(--red);transition:width 1s cubic-bezier(.16,1,.3,1)}

@media(max-width:640px){.glass-card{border-radius:12px}main{padding-left:16px!important;padding-right:16px!important}}
</style>
</head>
<body>
<div class="quiz-progress"><div class="quiz-progress-fill" id="top-progress" style="width:0%"></div></div>

<div class="fixed z-0 pointer-events-none flex max-w-6xl border-x border-white/5 mx-auto px-4 top-0 right-0 bottom-0 left-0 justify-between">
<div class="w-px h-full bg-white/5 relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-[200px] bg-gradient-to-b from-transparent via-[rgba(255,23,23,.4)] to-transparent animate-[border-beam_5s_linear_infinite]"></div></div>
<div class="w-px h-full bg-white/5 hidden md:block relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-[200px] bg-gradient-to-b from-transparent via-[rgba(255,23,23,.4)] to-transparent animate-[border-beam_7s_linear_infinite_2s]"></div></div>
<div class="w-px h-full bg-white/5 hidden lg:block relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-[200px] bg-gradient-to-b from-transparent via-[rgba(255,23,23,.4)] to-transparent animate-[border-beam_5s_linear_infinite_4s]"></div></div>
<div class="w-px h-full bg-white/5 relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-[200px] bg-gradient-to-b from-transparent via-[rgba(255,23,23,.4)] to-transparent animate-[border-beam_8s_linear_infinite_1s]"></div></div>
</div>

<header class="relative z-10 text-center pt-6 pb-1" id="site-header">
<div class="inline-flex items-center gap-2"><span class="font-oswald text-xl font-bold tracking-wider text-white/50">9MM</span><span class="text-[8px] text-white/20 tracking-[.3em] uppercase mt-0.5">Beyond Energy</span></div>
</header>

<main class="max-w-lg mx-auto px-5 pb-16 relative z-10 flex flex-col" id="main" style="min-height:calc(100vh - 120px)">
<div class="fixed top-0 left-0 w-[500px] h-[500px] bg-red-500/5 rounded-full blur-[200px] pointer-events-none"></div>

<!-- Container for all steps -->
<div id="step-container" class="flex-1 flex flex-col justify-center py-8"></div>

</main>

<footer class="relative z-10 text-center py-8 mt-8">
<div class="max-w-md mx-auto border-t border-white/5 pt-6"><span class="font-oswald text-lg font-bold text-white/40">9MM</span><span class="text-[9px] text-white/20 tracking-[.2em] uppercase ml-2">Beyond Energy</span><p class="text-white/20 text-xs mt-2">&copy; 2026 9MM Suisse SA</p></div>
</footer>

<script>
const TOTAL_STEPS = 22;
let currentStep = 0;
const answers = {};

// ===================== STEP DEFINITIONS =====================
const steps = [
  // 0 ‚Äî LANDING
  { type:'landing', render: () => `
    <div class="text-center fade-in">
      <span class="inline-block text-xs tracking-[.3em] uppercase px-3 py-1 rounded-full mb-6" style="background:rgba(255,23,23,.08);color:var(--red);border:1px solid rgba(255,23,23,.15)">&#9733; PROGRAMME MILITAIRE &#9733;</span>
      <h1 class="font-oswald text-4xl md:text-5xl font-bold uppercase leading-[.85] mb-4">Challenge<br/>d'entrainement<br/><span style="color:var(--red)">militaire avance</span></h1>
      <p class="text-white/40 text-sm mb-8">SELECTIONNEZ VOTRE AGE</p>
      <div class="grid grid-cols-2 gap-3 max-w-xs mx-auto">
        <button class="opt-btn justify-center" onclick="pick(0,'age','18-29')"><span>18-29</span></button>
        <button class="opt-btn justify-center" onclick="pick(0,'age','30-39')"><span>30-39</span></button>
        <button class="opt-btn justify-center" onclick="pick(0,'age','40-49')"><span>40-49</span></button>
        <button class="opt-btn justify-center" onclick="pick(0,'age','50+')"><span>50+</span></button>
      </div>
    </div>`
  },
  // 1 ‚Äî Genre
  { type:'single', q:'Choisissez votre genre', opts:[
    {t:'Homme',icon:'‚ôÇÔ∏è'},{t:'Femme',icon:'‚ôÄÔ∏è'}
  ], key:'genre' },
  // 2 ‚Äî Objectif
  { type:'single', q:'Quel est votre objectif principal ?', opts:[
    {t:'Prendre du muscle et de la force',icon:'üí™'},{t:'Perdre du poids',icon:'üî•'},{t:'Ameliorer la mobilite',icon:'üßò'},{t:'Developper la flexibilite',icon:'ü§∏'},{t:'Ameliorer la forme generale',icon:'‚ö°'},{t:'Tester de nouvelles facons de s\'entrainer',icon:'üÜï'}
  ], key:'objectif' },
  // 3 ‚Äî Zones problematiques (multi)
  { type:'multi', q:'Selectionnez les zones problematiques', opts:[
    {t:'Poitrine faible',icon:'ü´Å'},{t:'Bras fins',icon:'üí™'},{t:'Ventre a biere',icon:'üç∫'},{t:'Jambes fines',icon:'ü¶µ'}
  ], key:'zones' },
  // 4 ‚Äî Experience militaire
  { type:'single', q:'Connaissez-vous les methodes d\'entrainement de style militaire ?', opts:[
    {t:'Oui, j\'ai un peu d\'experience',icon:'‚úÖ'},{t:'Je m\'y connais un peu',icon:'ü§î'},{t:'Non, pas du tout',icon:'‚ùå'}
  ], key:'experience' },
  // 5 ‚Äî Slide educative
  { type:'slide', render: () => `
    <div class="fade-in">
      <div class="glass-card p-6 text-center" style="border-color:rgba(255,23,23,.1)">
        <span style="font-size:40px">üéñÔ∏è</span>
        <h2 class="font-oswald text-xl font-bold uppercase mt-3 mb-3">Entrainez-vous comme les meilleurs</h2>
        <p class="text-white/50 text-sm leading-relaxed mb-4">Un programme d'entrainement inspire par l'armee suit un systeme eprouve qui developpe :</p>
        <div class="space-y-2 text-left max-w-xs mx-auto mb-6">
          <div class="flex items-center gap-3"><span style="color:var(--red)">&#9733;</span><span class="text-white/70 text-sm">La force fonctionnelle</span></div>
          <div class="flex items-center gap-3"><span style="color:var(--red)">&#9733;</span><span class="text-white/70 text-sm">L'endurance</span></div>
          <div class="flex items-center gap-3"><span style="color:var(--red)">&#9733;</span><span class="text-white/70 text-sm">La resilience mentale</span></div>
        </div>
        <button class="btn-red" onclick="goNext()" style="max-width:260px;margin:0 auto">COMPRIS &rarr;</button>
      </div>
    </div>`
  },
  // 6 ‚Äî Meilleure forme
  { type:'single', q:'Il y a combien de temps etiez-vous en meilleure forme de votre vie ?', opts:[
    {t:'Il y a moins d\'un an',icon:'üìÖ'},{t:'Il y a 1 a 3 ans',icon:'üìÜ'},{t:'Il y a plus de 3 ans',icon:'‚è≥'},{t:'Jamais',icon:'ü§∑'}
  ], key:'best_shape' },
  // 7 ‚Äî Pompes
  { type:'single', q:'Combien de pompes pouvez-vous faire en une serie ?', opts:[
    {t:'Moins de 10 üí™',icon:'1Ô∏è‚É£',score:5},{t:'10 a 20 üí™üí™',icon:'2Ô∏è‚É£',score:10},{t:'21 a 30 üí™üí™üí™',icon:'3Ô∏è‚É£',score:20},{t:'Plus de 30 üò§',icon:'4Ô∏è‚É£',score:30}
  ], key:'pompes' },
  // 8 ‚Äî Tractions
  { type:'single', q:'Combien de tractions pouvez-vous faire en une serie ?', opts:[
    {t:'Je ne peux pas en faire une seule',icon:'0Ô∏è‚É£',score:0},{t:'Moins de 5 üî•',icon:'1Ô∏è‚É£',score:8},{t:'5 a 10 üî•üî•',icon:'2Ô∏è‚É£',score:18},{t:'Plus de 10 üî•üî•üî•',icon:'3Ô∏è‚É£',score:30}
  ], key:'tractions' },
  // 9 ‚Äî Score intermediaire
  { type:'score', render: () => {
    const p = answers.pompes_score || 0;
    const t = answers.tractions_score || 0;
    const total = p + t;
    const maxScore = 60;
    const pct = Math.round((total/maxScore)*100);
    let level = 'Debutant';
    if(pct >= 80) level = 'Avance';
    else if(pct >= 50) level = 'Intermediaire';
    answers.fitness_score = total;
    answers.fitness_level = level;
    const forceScore = Math.min(30, Math.round(p * 1));
    const endScore = Math.min(30, Math.round(t * 1.1 + 5));
    return `
    <div class="fade-in text-center">
      <div class="glass-card p-8" style="border-color:rgba(255,23,23,.12);box-shadow:0 0 40px rgba(255,23,23,.05)">
        <span class="text-[10px] tracking-[.2em] uppercase text-white/30">Votre niveau de forme physique</span>
        <div class="mt-3 mb-2"><span class="font-oswald text-5xl font-bold" style="color:var(--red)">${total}</span><span class="text-white/30 text-lg ml-1">/${maxScore}</span></div>
        <p class="font-oswald text-lg font-bold uppercase mb-1" style="color:var(--red)">${level}</p>
        <p class="text-white/40 text-sm mb-6 max-w-sm mx-auto">${pct >= 50 ? 'Grand potentiel ! Vous allez recevoir un programme concu pour challenger et ameliorer votre force, votre endurance et vos performances globales.' : 'Parfait pour commencer ! Votre programme sera adapte a votre niveau actuel pour progresser rapidement.'}</p>
        <div class="space-y-3 text-left max-w-xs mx-auto mb-6">
          <div><div class="flex justify-between text-xs mb-1"><span class="text-white/40">Force</span><span style="color:var(--red)">${forceScore}/30</span></div><div class="stat-bar"><div class="stat-fill" style="width:${(forceScore/30)*100}%"></div></div></div>
          <div><div class="flex justify-between text-xs mb-1"><span class="text-white/40">Endurance</span><span style="color:var(--red)">${endScore}/30</span></div><div class="stat-bar"><div class="stat-fill" style="width:${(endScore/30)*100}%"></div></div></div>
        </div>
        <p class="text-[10px] text-white/20 mb-4">Ce score est base sur vos reponses et est fourni a titre informatif uniquement.</p>
        <button class="btn-red" onclick="goNext()" style="max-width:240px;margin:0 auto">CONTINUER &rarr;</button>
      </div>
    </div>`;
  }},
  // 10 ‚Äî Blessures (multi)
  { type:'multi', q:'Avez-vous des blessures ? Nous adapterons le programme.', opts:[
    {t:'Articulations',icon:'ü¶¥'},{t:'Genoux',icon:'ü¶µ'},{t:'Dos',icon:'üîô'},{t:'Bas du dos',icon:'‚¨áÔ∏è'},{t:'Aucune des reponses ci-dessus',icon:'‚úÖ'}
  ], key:'blessures' },
  // 11 ‚Äî Slide comparaison
  { type:'slide', render: () => `
    <div class="fade-in">
      <div class="glass-card p-6" style="border-color:rgba(255,23,23,.1)">
        <h2 class="font-oswald text-lg font-bold uppercase mb-4 text-center">Vraie force : au-dela de l'esthetique</h2>
        <table class="compare-table mb-4">
          <tr><td></td><td class="compare-col-gym text-center font-bold text-xs uppercase">Salle üèã</td><td class="compare-col-mil text-center font-bold text-xs uppercase">Militaire üöÄ</td></tr>
          <tr><td>Focus</td><td class="compare-col-gym text-center">Esthetique</td><td class="compare-col-mil text-center">Fonctionnalite</td></tr>
          <tr><td>Outils</td><td class="compare-col-gym text-center">Machines</td><td class="compare-col-mil text-center">Poids du corps</td></tr>
          <tr><td>Objectif</td><td class="compare-col-gym text-center">Volume</td><td class="compare-col-mil text-center">Force reelle</td></tr>
        </table>
        <p class="text-white/40 text-sm text-center mb-4">Les entrainements militaires privilegient une force pratique et applicable dans la vie reelle.</p>
        <button class="btn-red" onclick="goNext()" style="max-width:240px;margin:0 auto;display:block">COMPRIS &rarr;</button>
      </div>
    </div>`
  },
  // 12 ‚Äî Frequence
  { type:'single', q:'A quelle frequence etes-vous pret a vous entrainer ?', opts:[
    {t:'1 a 2 fois par semaine üí™',icon:'1Ô∏è‚É£'},{t:'3 a 4 fois par semaine üí™‚ö°',icon:'3Ô∏è‚É£'},{t:'Presque tous les jours üèÜ',icon:'üî•'},{t:'Je ne sais pas encore',icon:'ü§∑'}
  ], key:'frequence' },
  // 13 ‚Äî Duree
  { type:'single', q:'Combien de temps etes-vous pret a consacrer a un entrainement ?', opts:[
    {t:'5 a 10 minutes par jour',icon:'‚è±Ô∏è'},{t:'10 a 20 minutes par jour',icon:'‚è∞'},{t:'Plus de 20 minutes par jour',icon:'üïê'}
  ], key:'duree' },
  // 14 ‚Äî Taille
  { type:'input', q:'Quelle est votre taille ?', key:'taille', unit:'cm', placeholder:'175', inputType:'number', note:'Calcul de votre indice de masse corporelle (IMC). L\'IMC est largement utilise comme indicateur de risque de sante.' },
  // 15 ‚Äî Poids
  { type:'input', q:'Quel est votre poids actuel ?', key:'poids', unit:'kg', placeholder:'80', inputType:'number', note:'' },
  // 16 ‚Äî Journee type
  { type:'single', q:'Comment decririez-vous votre journee type ?', opts:[
    {t:'Je passe la majeure partie de la journee assis',icon:'ü™ë'},{t:'Je bouge de temps en temps',icon:'üö∂'},{t:'Je suis debout toute la journee',icon:'üèÉ'}
  ], key:'journee' },
  // 17 ‚Äî Energie
  { type:'single', q:'Quel est votre niveau d\'energie moyen au cours de la journee ?', opts:[
    {t:'Je me sens epuise la plupart du temps üòì',icon:'üòì'},{t:'Mon niveau d\'energie varie au cours de la journee üìä',icon:'üìä'},{t:'Je suis generalement tres energique et actif üí•',icon:'üí•'}
  ], key:'energie' },
  // 18 ‚Äî Slider 1
  { type:'slider', q:'J\'ai besoin de structure ou de guidance pendant les entrainements pour rester motive(e)', key:'structure', labels:['Pas d\'accord','Neutre','D\'accord'] },
  // 19 ‚Äî Slider 2
  { type:'slider', q:'Je ressens souvent que je n\'exploite pas pleinement le potentiel que je sais avoir', key:'potentiel', labels:['Pas d\'accord','Neutre','D\'accord'] },
  // 20 ‚Äî Slider 3
  { type:'slider', q:'Je ne sais pas comment choisir des entrainements adaptes a moi', key:'choix', labels:['Pas d\'accord','Neutre','D\'accord'] },
  // 21 ‚Äî Email capture
  { type:'email', render: () => `
    <div class="fade-in text-center">
      <div class="glass-card p-8" style="border-color:rgba(255,23,23,.1);box-shadow:0 0 40px rgba(255,23,23,.05)">
        <span style="font-size:40px">üéñÔ∏è</span>
        <h2 class="font-oswald text-2xl font-bold uppercase mt-3 mb-2">Votre programme est pret !</h2>
        <p class="text-white/40 text-sm mb-6">Entrez votre email pour recevoir votre plan d'entrainement militaire personnalise.</p>
        <form id="lead-form" onsubmit="captureEmail(event)" class="space-y-4 max-w-xs mx-auto">
          <div class="form-group"><label>Email</label><input type="email" name="email" placeholder="name@example.com" required/></div>
          <div class="form-group"><label>Departement <span style="color:rgba(255,255,255,.2)">(optionnel)</span></label><input type="text" name="departement" placeholder="Ex: 75" maxlength="3" inputmode="numeric"/></div>
          <button type="submit" class="btn-red">CONTINUER &rarr;</button>
        </form>
        <p class="text-white/40 text-xs font-semibold mt-3">100% gratuit</p>
        <p class="text-white/15 text-[10px] mt-1">Nous respectons votre vie privee ‚Äî aucun spam.</p>
      </div>
    </div>`
  },
  // 22 ‚Äî Loading screen (after email)
  { type:'loading' }
];

// ===================== RENDERING =====================
function renderStep(idx) {
  currentStep = idx;
  const s = steps[idx];
  const container = document.getElementById('step-container');
  updateProgress();

  if(s.type === 'landing' || s.type === 'slide' || s.type === 'score' || s.type === 'email') {
    container.innerHTML = s.render();
    window.scrollTo({top:0,behavior:'smooth'});
    return;
  }

  if(s.type === 'loading') {
    showLoadingScreen();
    return;
  }

  // Step counter for questions
  const stepNum = idx + 1;
  const stepLabel = `<div class="flex items-center justify-between mb-5"><span class="text-[10px] text-white/20 uppercase tracking-wider font-oswald">Question ${stepNum}/${TOTAL_STEPS}</span><span class="text-[10px] text-white/15">${Math.round((idx/(steps.length-1))*100)}%</span></div>`;

  if(s.type === 'single') {
    container.innerHTML = `<div class="fade-in"><div class="glass-card p-6 md:p-8" style="border-color:rgba(255,23,23,.08)">${stepLabel}<h2 class="font-oswald text-2xl md:text-3xl font-bold uppercase mb-6 leading-tight">${s.q}</h2><div class="space-y-3" id="opts"></div></div></div>`;
    const optsEl = document.getElementById('opts');
    s.opts.forEach((o,i) => {
      const btn = document.createElement('button');
      btn.className = 'opt-btn';
      btn.innerHTML = `<span class="opt-icon">${o.icon||''}</span><span>${o.t}</span>`;
      btn.onclick = () => {
        answers[s.key] = o.t;
        if(o.score !== undefined) answers[s.key+'_score'] = o.score;
        document.querySelectorAll('#opts .opt-btn').forEach(b=>b.classList.remove('selected'));
        btn.classList.add('selected');
        setTimeout(goNext, 350);
      };
      optsEl.appendChild(btn);
    });
  }

  if(s.type === 'multi') {
    const selected = new Set();
    container.innerHTML = `<div class="fade-in"><div class="glass-card p-6 md:p-8" style="border-color:rgba(255,23,23,.08)">${stepLabel}<h2 class="font-oswald text-2xl md:text-3xl font-bold uppercase mb-6 leading-tight">${s.q}</h2><div class="space-y-3" id="opts"></div><button class="btn-red mt-6" id="multi-next" disabled onclick="goNext()">CONTINUER &rarr;</button></div></div>`;
    const optsEl = document.getElementById('opts');
    s.opts.forEach((o,i) => {
      const btn = document.createElement('button');
      btn.className = 'opt-btn multi';
      btn.innerHTML = `<span class="opt-icon">${o.icon||''}</span><span>${o.t}</span>`;
      btn.onclick = () => {
        if(selected.has(i)){selected.delete(i);btn.classList.remove('selected');}
        else{selected.add(i);btn.classList.add('selected');}
        answers[s.key] = [...selected].map(idx=>s.opts[idx].t);
        document.getElementById('multi-next').disabled = selected.size === 0;
      };
      optsEl.appendChild(btn);
    });
  }

  if(s.type === 'input') {
    container.innerHTML = `<div class="fade-in"><div class="glass-card p-6 md:p-8" style="border-color:rgba(255,23,23,.08)">${stepLabel}<h2 class="font-oswald text-2xl md:text-3xl font-bold uppercase mb-6 leading-tight">${s.q}</h2>
      <div class="max-w-xs mx-auto">
        <div class="form-group mb-2"><label>${s.unit}</label><input type="${s.inputType}" id="input-val" placeholder="${s.placeholder}" inputmode="numeric"/></div>
        ${s.note ? '<p class="text-white/20 text-[10px] mb-4">&#9757; '+s.note+'</p>' : ''}
        <button class="btn-red mt-4" id="input-next" onclick="submitInput('${s.key}')" disabled>CONTINUER &rarr;</button>
      </div>
    </div></div>`;
    const inp = document.getElementById('input-val');
    inp.addEventListener('input', () => {
      document.getElementById('input-next').disabled = !inp.value || isNaN(inp.value);
    });
    inp.focus();
  }

  if(s.type === 'slider') {
    let val = 1;
    container.innerHTML = `<div class="fade-in"><div class="glass-card p-6 md:p-8" style="border-color:rgba(255,23,23,.08)">${stepLabel}<h2 class="font-oswald text-xl md:text-2xl font-bold uppercase mb-8 leading-tight">"${s.q}"</h2>
      <div class="max-w-sm mx-auto mb-8">
        <div class="slider-track" id="slider-track">
          <div class="slider-fill" id="slider-fill" style="width:50%"></div>
          <div class="slider-thumb" id="slider-thumb" style="left:50%"></div>
        </div>
        <div class="slider-labels">${s.labels.map(l=>'<span>'+l+'</span>').join('')}</div>
      </div>
      <div class="text-center"><button class="btn-red" style="max-width:240px" onclick="submitSlider('${s.key}')">CONTINUER &rarr;</button></div>
    </div></div>`;
    const track = document.getElementById('slider-track');
    const fill = document.getElementById('slider-fill');
    const thumb = document.getElementById('slider-thumb');
    function updateSlider(e) {
      const rect = track.getBoundingClientRect();
      let pct = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
      fill.style.width = (pct*100)+'%';
      thumb.style.left = (pct*100)+'%';
      val = pct;
    }
    track.addEventListener('click', updateSlider);
    let dragging = false;
    thumb.addEventListener('mousedown', ()=>dragging=true);
    thumb.addEventListener('touchstart', ()=>dragging=true, {passive:true});
    document.addEventListener('mousemove', (e)=>{if(dragging)updateSlider(e);});
    document.addEventListener('touchmove', (e)=>{if(dragging)updateSlider(e.touches[0]);}, {passive:true});
    document.addEventListener('mouseup', ()=>dragging=false);
    document.addEventListener('touchend', ()=>dragging=false);
    window._sliderVal = () => val;
  }

  window.scrollTo({top:0,behavior:'smooth'});
}

function submitInput(key) {
  answers[key] = document.getElementById('input-val').value;
  goNext();
}

function submitSlider(key) {
  answers[key] = window._sliderVal();
  goNext();
}

function pick(stepIdx, key, val) {
  answers[key] = val;
  goNext();
}

function goNext() {
  if(currentStep < steps.length - 1) {
    renderStep(currentStep + 1);
  }
}

function updateProgress() {
  const pct = Math.round((currentStep / (steps.length-1)) * 100);
  document.getElementById('top-progress').style.width = pct + '%';
}

// ===================== LOADING SCREEN =====================
function showLoadingScreen() {
  const loadingSteps = [
    'Analyse des donnees...',
    'Mesure du profil corporel...',
    'Suggestion d\'un programme d\'entrainement...',
    'Elaboration d\'un plan pour atteindre vos objectifs...',
    'Votre plan personnalise est pret !'
  ];
  const container = document.getElementById('step-container');
  container.innerHTML = `<div class="fade-in text-center">
    <div class="glass-card p-8" style="border-color:rgba(255,23,23,.1)">
      <span style="font-size:48px">‚öôÔ∏è</span>
      <h2 class="font-oswald text-xl font-bold uppercase mt-4 mb-6">Creation de votre programme</h2>
      <div class="loading-bar"><div class="loading-bar-fill" id="loading-bar-fill" style="width:0%"></div></div>
      <div class="text-left max-w-sm mx-auto" id="loading-steps">${loadingSteps.map((s,i)=>`<div class="loading-step" id="ls-${i}"><div class="loading-dot"></div><span class="text-sm text-white/60">${s}</span></div>`).join('')}</div>
    </div>
  </div>`;

  let step = 0;
  const interval = setInterval(() => {
    if(step > 0) document.getElementById('ls-'+(step-1)).className = 'loading-step done';
    if(step < loadingSteps.length) {
      document.getElementById('ls-'+step).className = 'loading-step active';
      document.getElementById('loading-bar-fill').style.width = ((step+1)/loadingSteps.length*100)+'%';
    }
    step++;
    if(step > loadingSteps.length) {
      clearInterval(interval);
      setTimeout(showResult, 800);
    }
  }, 1200);
}

// ===================== EMAIL CAPTURE =====================
function captureEmail(e) {
  e.preventDefault();
  const fd = new FormData(e.target);
  const data = {};
  fd.forEach((v,k) => data[k] = v);
  data.source = 'quiz-military-training';
  data.answers = JSON.stringify(answers);
  data.timestamp = new Date().toISOString();
  console.log('9MM Lead captured:', data);
  // TODO: API call
  goNext(); // Go to loading screen
}

// ===================== RESULT SCREEN =====================
function showResult() {
  const taille = parseFloat(answers.taille) || 175;
  const poids = parseFloat(answers.poids) || 80;
  const imc = (poids / ((taille/100) * (taille/100))).toFixed(1);
  const fitnessScore = answers.fitness_score || 30;
  const level = answers.fitness_level || 'Intermediaire';

  const container = document.getElementById('step-container');
  document.getElementById('top-progress').style.width = '100%';

  container.innerHTML = `<div class="fade-in">
    <!-- Result header -->
    <div class="text-center mb-6">
      <span class="inline-block text-xs tracking-[.3em] uppercase px-3 py-1 rounded-full mb-3" style="background:rgba(255,23,23,.08);color:var(--red);border:1px solid rgba(255,23,23,.15)">VOTRE PROGRAMME</span>
      <h2 class="font-oswald text-3xl md:text-4xl font-bold uppercase mb-2">Programme Militaire<br/><span style="color:var(--red)">Personnalise</span></h2>
    </div>

    <!-- Scores -->
    <div class="glass-card p-6 mb-4" style="border-color:rgba(255,23,23,.1)">
      <div class="flex items-center justify-between mb-4">
        <div><span class="text-[10px] text-white/30 uppercase tracking-wider">Votre IMC</span><div class="font-oswald text-2xl font-bold mt-1" style="color:var(--red)">${imc}</div></div>
        <div class="text-right"><span class="text-[10px] text-white/30 uppercase tracking-wider">Fitness Score</span><div class="font-oswald text-2xl font-bold mt-1" style="color:var(--red)">${fitnessScore}/60</div></div>
      </div>
      <div class="text-center"><span class="inline-block text-xs px-3 py-1 rounded-full font-bold" style="background:rgba(255,23,23,.1);color:var(--red)">${level}</span></div>
    </div>

    <!-- Preview progression -->
    <div class="glass-card p-6 mb-4" style="border-color:rgba(255,23,23,.1)">
      <h3 class="font-oswald text-base font-bold uppercase mb-1">Des premiers resultats des 2 semaines</h3>
      <p class="text-white/30 text-xs mb-4">En fonction de votre regularite et de votre engagement.</p>
      <div class="flex items-end justify-between gap-2" style="height:80px">
        <div class="flex flex-col items-center gap-1 flex-1"><div class="w-full rounded-t-md" style="height:20px;background:rgba(255,23,23,.15)"></div><span class="text-[9px] text-white/25">Maintenant</span></div>
        <div class="flex flex-col items-center gap-1 flex-1"><div class="w-full rounded-t-md" style="height:35px;background:rgba(255,23,23,.25)"></div><span class="text-[9px] text-white/25">2 sem. üî•</span></div>
        <div class="flex flex-col items-center gap-1 flex-1"><div class="w-full rounded-t-md" style="height:50px;background:rgba(255,23,23,.4)"></div><span class="text-[9px] text-white/25">1 mois</span></div>
        <div class="flex flex-col items-center gap-1 flex-1"><div class="w-full rounded-t-md" style="height:65px;background:rgba(255,23,23,.6)"></div><span class="text-[9px] text-white/25">2 mois</span></div>
        <div class="flex flex-col items-center gap-1 flex-1"><div class="w-full rounded-t-md" style="height:80px;background:var(--red)"></div><span class="text-[9px] text-white/25">3 mois</span></div>
      </div>
      <p class="text-[9px] text-white/15 mt-3">Graphique illustratif. Les resultats peuvent varier.</p>
    </div>

    <!-- Produit -->
    <div class="glass-card p-5 mb-4" style="border-color:rgba(255,23,23,.1)">
      <div class="flex items-center gap-4">
        <div class="w-[50px] h-[70px] rounded-lg flex items-center justify-center shrink-0" style="background:rgba(255,23,23,.08);border:1px solid rgba(255,23,23,.12)"><span class="font-oswald text-sm font-bold" style="color:var(--red)">9MM</span></div>
        <div>
          <h3 class="font-oswald text-sm font-bold uppercase">9MM Active Body</h3>
          <p class="text-white/35 text-xs mt-0.5">Recommande pour votre programme ‚Äî endurance et energie naturelle pour chaque session.</p>
        </div>
      </div>
    </div>

    <!-- CTA -->
    <a href="https://9mm-energy.com" class="btn-red block text-center" style="text-decoration:none">DECOUVRIR 9MM &rarr;</a>
    <p class="text-center text-white/15 text-[10px] mt-3">Votre programme detaille a ete envoye par email.</p>

    <!-- Cross-links -->
    <div class="mt-10 pt-6" style="border-top:1px solid rgba(255,255,255,.05)">
      <p class="text-[10px] text-white/20 uppercase tracking-wider text-center mb-4">Decouvre aussi</p>
      <div class="space-y-2">
        <a href="pro-match-quiz.html" class="glass-card p-4 flex items-center gap-3 transition-all hover:border-[rgba(255,23,23,.25)]" style="text-decoration:none;border-color:rgba(255,23,23,.08)"><span class="text-lg">&#129354;</span><div><p class="text-white/70 text-sm font-semibold">Ton Style de Boxe</p><p class="text-white/30 text-[10px]">Analyse morphologique</p></div></a>
        <a href="reaction-time-test.html" class="glass-card p-4 flex items-center gap-3 transition-all hover:border-[rgba(0,237,239,.25)]" style="text-decoration:none;border-color:rgba(0,237,239,.08)"><span class="text-lg">&#9889;</span><div><p class="text-white/70 text-sm font-semibold">Reaction Time Test</p><p class="text-white/30 text-[10px]">Teste tes reflexes</p></div></a>
        <a href="focus-score-test.html" class="glass-card p-4 flex items-center gap-3 transition-all hover:border-[rgba(0,237,239,.25)]" style="text-decoration:none;border-color:rgba(0,237,239,.08)"><span class="text-lg">&#127919;</span><div><p class="text-white/70 text-sm font-semibold">Focus Score Test</p><p class="text-white/30 text-[10px]">Teste ta concentration</p></div></a>
        <a href="streak-tracker.html" class="glass-card p-4 flex items-center gap-3 transition-all hover:border-[rgba(0,237,239,.25)]" style="text-decoration:none;border-color:rgba(0,237,239,.08)"><span class="text-lg">&#127918;</span><div><p class="text-white/70 text-sm font-semibold">Challenge Fortnite 7 Jours</p><p class="text-white/30 text-[10px]">Programme gaming</p></div></a>
      </div>
    </div>
  </div>`;
}

// ===================== INIT =====================
renderStep(0);
</script>
</body>
</html>
